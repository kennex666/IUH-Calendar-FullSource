<!DOCTYPE html>
<html lang="en">
<head>  

    <noscript>
        <meta http-equiv='refresh'
            content='0;url=noJS.html?src=https%3A%2F%2Fpj.dtbao.io.vn%2Fpj%2FSchendar-Clients%2Findex.html'>
    </noscript>

    <style>
        #txtKLichHoc {
            min-width: 25%;
        }
    </style>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lịch học tự động | Powered by 1Box Studios</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>

    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
        <symbol id="check-circle-fill" fill="currentColor" viewBox="0 0 16 16">
            <path
                d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z" />
        </symbol>
        <symbol id="info-fill" fill="currentColor" viewBox="0 0 16 16">
            <path
                d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z" />
        </symbol>
        <symbol id="exclamation-triangle-fill" fill="currentColor" viewBox="0 0 16 16">
            <path
                d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z" />
        </symbol>
    </svg>

</head>
<body>

    <div id="modalShowLich" class="modal fade">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">Tạo lịch thành công!</div>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Lịch học đã được khởi tạo thành công. Bên dưới là đường dẫn để liên kết lịch với Google Calendar</p>
                    <div class="input-group pb-4" name="Lịch học URL">
                        <span class="input-group-text">Lịch học</span>
                        <input id="urlLichHoc" class="form-control bg-white" value="" disabled/>
                        <button class="btn btn-success" id="btnLichHocCopy">Copy</button>
                    </div>
                    <div class="input-group pb-4" name="Lịch thi URL">
                        <span class="input-group-text">Lịch thi</span>
                        <input id="urlLichThi" class="form-control bg-white" value="" disabled/>
                        <button class="btn btn-success" id="btnLichThiCopy">Copy</button>
                    </div>
                    <div class="input-group pb-4" name="Lịch cả học & thi URL">
                        <span class="input-group-text">Lịch học & thi</span>
                        <input id="urlLichHocThi" class="form-control bg-white" value="" disabled/>
                        <button class="btn btn-success" id="btnLichHocThiCopy">Copy</button>
                    </div>
                   
                </div>
                <div class="modal-footer">
                    <a class="btn btn-primary" target="_blank" href="https://calendar.google.com/calendar/r/settings/addbyurl">Đến Google Calendar</a>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="row">
        <div class="navbar navbar-light bg-light nav-tabs">
            <nav class="navbar">
                <a href="https://facebook.com/103211735992722" class="navbar-brand fw-bold">Schendar (Test)</a>
            </nav>
            <button class="navbar-toggler d-md-none" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarNav">
                <a class="nav-item nav-link" href="https://1boxstudios.com/">Trang chủ</a>
                <a class="nav-item nav-link"
                    href="https://www.facebook.com/iuhCalendar/posts/pfbid02QTCSzzj6kjgtYDYHarTcKJ4qz7P6j7JsrCtetKMjmesHYrUrmrodwnJdxA12xkiQl">Thông
                    tin</a>
                <a class="nav-item nav-link" href="https://www.facebook.com/iuhCalendar/posts/pfbid02msaJPxRrvjMiop6ZcqdwWsjgqhkVdZkVtV2Ks9DX9FHVZ4AHX4MRoRnFkp24RGwkl">Trợ giúp</a>
                <a class="nav-item nav-link" href="https://1boxstudios.com/">Đăng kí</a>
                
                <button class="nav-item nav-link" data-bs-toggle="modal" data-bs-target="#modalShowLich">Test mode</button>
            </div>


            <nav class="navbar d-none d-sm-flex">
                <a class="nav-item nav-link" href="https://1boxstudios.com/">Trang chủ</a>
                <a class="nav-item nav-link"
                    href="https://www.facebook.com/iuhCalendar/posts/pfbid02QTCSzzj6kjgtYDYHarTcKJ4qz7P6j7JsrCtetKMjmesHYrUrmrodwnJdxA12xkiQl">Thông
                    tin</a>
                <a class="nav-item nav-link" href="https://www.facebook.com/iuhCalendar/posts/pfbid02msaJPxRrvjMiop6ZcqdwWsjgqhkVdZkVtV2Ks9DX9FHVZ4AHX4MRoRnFkp24RGwkl">Trợ giúp</a>
                <a class="nav-item nav-link" href="https://1boxstudios.com/">Đăng kí</a>
                
                <button class="nav-item nav-link" data-bs-toggle="modal" data-bs-target="#modalShowLich">Test mode</button>
            </nav>

            
        </div>
        
        <div class="row">
            <div id="alertMsg" class="alert alert-warning alert-dismissible fade d-none" role="alert">
                <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Warning:">
                    <use xlink:href="#exclamation-triangle-fill" />
                </svg>
                <span id="errMsg">Chưa đủ thông tin!</span>
            </div>
        </div>

        <div class="pt-5"></div>

        <div class="d-none d-md-flex justify-content-center">
            <img src="img/Planning-2.png" alt="Banner Image"
                class="w-50 mb-5">
        </div>

        <div class="d-sm-flex d-md-none  justify-content-center">
            <img src="img/Planning-2.png" alt="Banner Image"
                class="w-100 mb-5">
        </div>

        <form id="frmGetLichHoc" action="#" method="POST">
            <div class="input-group mb-3">
                <span class="input-group-text">Trường</span>
                <select name="school" id="sltSchool" class="form-select" aria-label="Select your school">
                    <option value="-1" selected>Click vào đây để chọn trường</option>
                    <option value="0">IUH - Trường Đại học Công Nghiệp Tp.HCM</option>
                    <option value="1">UT - Trường Đại học Giao Thông Vận Tải Tp.HCM</option>
                    <option value="2">GDU - Trường Đại học Gia Định</option>
                    <option value="3">NTT - Trường Đại học Nguyễn Tất Thành</option>
                </select>
            </div>

            <p class="ps-md-3 d-none" id="lblTrangTraCuu">Hãy truy cập <a id="lblUrl" target="_blank" href="https://sv.iuh.edu.vn/tra-cuu-thong-tin.html">trang
                    tra cứu</a> và làm theo hướng dẫn để lấy link lịch học</p>

            <p class="ps-md-3">Sau khi lấy link lịch học thành công, dán vào ô bên dưới nhé!</p>


            <div id="formInputUrl" class="input-group mb-3 d-none">
                <span class="input-group-text" id="lblKLichHoc">https://sv.iuh.edu.vn/tra-cuu/lich-hoc-tuan.html?k=</span>
                <input class="form-control" type="text" name="url" id="txtKLichHoc" placeholder="XXXXXXXXXXXX" disabled>
            </div>
            <button class="btn btn-primary" id="btnSubmit" type="submit" disabled>Tạo lịch</button>

            </div>
        </form>
       
    </div>
</body>

<script>

    function _0x1b6a() { const _0x1d69c1 = ['228039JoNNKL', '14597dweSJv', '__proto__', 'exception', 'toString', '97136BNNShl', 'error', '276DCaNDN', 'console', '{}.constructor(\x22return\x20this\x22)(\x20)', '(((.+)+)+)+$', '6427152CJfitf', '2060YdgmTX', '3996LYykvi', 'return\x20(function()\x20', 'bind', '25308NiAELr', '10414yotLSO', 'search', 'prototype', '100iIhOaU', 'constructor', '166IYxhEt', 'table', '2255463knnjOF', 'info', 'length']; _0x1b6a = function () { return _0x1d69c1; }; return _0x1b6a(); } (function (_0x3ec24f, _0x5010fa) { const _0x4cf96f = _0x1ccf, _0x591dfd = _0x3ec24f(); while (!![]) { try { const _0x9b6b3b = -parseInt(_0x4cf96f(0x12c)) / 0x1 * (-parseInt(_0x4cf96f(0x116)) / 0x2) + parseInt(_0x4cf96f(0x118)) / 0x3 + -parseInt(_0x4cf96f(0x120)) / 0x4 * (-parseInt(_0x4cf96f(0x114)) / 0x5) + parseInt(_0x4cf96f(0x122)) / 0x6 * (-parseInt(_0x4cf96f(0x11b)) / 0x7) + -parseInt(_0x4cf96f(0x126)) / 0x8 + parseInt(_0x4cf96f(0x12b)) / 0x9 * (parseInt(_0x4cf96f(0x127)) / 0xa) + parseInt(_0x4cf96f(0x11c)) / 0xb * (parseInt(_0x4cf96f(0x128)) / 0xc); if (_0x9b6b3b === _0x5010fa) break; else _0x591dfd['push'](_0x591dfd['shift']()); } catch (_0x34df0d) { _0x591dfd['push'](_0x591dfd['shift']()); } } }(_0x1b6a, 0xc8762)); const _0x11cba1 = (function () { let _0x47c69e = !![]; return function (_0x3dcfd5, _0x36b26f) { const _0x2a7872 = _0x47c69e ? function () { if (_0x36b26f) { const _0x56b8fc = _0x36b26f['apply'](_0x3dcfd5, arguments); return _0x36b26f = null, _0x56b8fc; } } : function () { }; return _0x47c69e = ![], _0x2a7872; }; }()), _0x4c07d7 = _0x11cba1(this, function () { const _0x273791 = _0x1ccf; return _0x4c07d7['toString']()[_0x273791(0x12d)](_0x273791(0x125))[_0x273791(0x11f)]()[_0x273791(0x115)](_0x4c07d7)[_0x273791(0x12d)](_0x273791(0x125)); }); _0x4c07d7(); const _0x17bcfa = (function () { let _0x443901 = !![]; return function (_0x8c92a, _0x307605) { const _0x3d9d76 = _0x443901 ? function () { if (_0x307605) { const _0x13ecbf = _0x307605['apply'](_0x8c92a, arguments); return _0x307605 = null, _0x13ecbf; } } : function () { }; return _0x443901 = ![], _0x3d9d76; }; }()), _0x44af55 = _0x17bcfa(this, function () { const _0x40be66 = _0x1ccf, _0x1bcc63 = function () { const _0x1ab97d = _0x1ccf; let _0x32c530; try { _0x32c530 = Function(_0x1ab97d(0x129) + _0x1ab97d(0x124) + ');')(); } catch (_0x43dce7) { _0x32c530 = window; } return _0x32c530; }, _0x28de1d = _0x1bcc63(), _0x2be0d1 = _0x28de1d[_0x40be66(0x123)] = _0x28de1d[_0x40be66(0x123)] || {}, _0x3b91ad = ['log', 'warn', _0x40be66(0x119), _0x40be66(0x121), _0x40be66(0x11e), _0x40be66(0x117), 'trace']; for (let _0x48538f = 0x0; _0x48538f < _0x3b91ad[_0x40be66(0x11a)]; _0x48538f++) { const _0xf2d49e = _0x17bcfa['constructor'][_0x40be66(0x12e)]['bind'](_0x17bcfa), _0x25fdcc = _0x3b91ad[_0x48538f], _0x186677 = _0x2be0d1[_0x25fdcc] || _0xf2d49e; _0xf2d49e[_0x40be66(0x11d)] = _0x17bcfa['bind'](_0x17bcfa), _0xf2d49e[_0x40be66(0x11f)] = _0x186677[_0x40be66(0x11f)][_0x40be66(0x12a)](_0x186677), _0x2be0d1[_0x25fdcc] = _0xf2d49e; } }); _0x44af55(); function _0x1ccf(_0x219447, _0x57fe3d) { const _0x446f9e = _0x1b6a(); return _0x1ccf = function (_0x44af55, _0x17bcfa) { _0x44af55 = _0x44af55 - 0x114; let _0x38af2c = _0x446f9e[_0x44af55]; return _0x38af2c; }, _0x1ccf(_0x219447, _0x57fe3d); } const antiDebug = () => { debugger; }; setInterval(() => { antiDebug(); }, 0xa);
        
    function copyURL(btn){
        var copyText = btn;

        // Select the text field
        copyText.select();
        copyText.setSelectionRange(0, 99999); // For mobile devices

        navigator.clipboard.writeText(copyText.value);

        // Alert the copied text
        alert("Copied url: " + copyText.value);
    }

    function getParameterByName(name, url = window.location.href) {
        name = name.replace(/[\[\]]/g, '\\$&');
        var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, ' '));
    }
    
    const schoolInformation = [
        {
            "sc": "iuh",
            "name": "Trường Đại học Công Nghiệp TP.HCM",
            "tc": "https://sv.iuh.edu.vn/tra-cuu-thong-tin.html",
            "urlChuan": "https://sv.iuh.edu.vn/tra-cuu/lich-hoc-tuan.html?k="
        },
        {
            "sc": "ut",
            "name": "Trường Đại học Giao Thông Vận Tải TP.HCM",
            "tc": "https://sv.ut.edu.vn/tra-cuu-thong-tin.html",
            "urlChuan": "https://sv.ut.edu.vn/tra-cuu/lich-hoc-tuan.html?k="
        },
        {
            "sc": "gdu",
            "name": "Trường Đại học Gia Định",
            "tc": "https://sinhvien.giadinh.edu.vn/tra-cuu-thong-tin.html",
            "urlChuan": "https://sinhvien.giadinh.edu.vn/tra-cuu/lich-hoc-tuan.html?k="
        },
        {
            "sc": "nnt",
            "name": "Trường Đại học Nguyễn Tất Thành",
            "tc": "https://phongdaotao.ntt.edu.vn/tra-cuu-thong-tin.html",
            "urlChuan": "https://phongdaotao.ntt.edu.vn/tra-cuu/lich-hoc-tuan.html?k="
        }
    ];

    const $ = document;

    var onChangeSchool = () =>{
        let scIndex = sltSchool.value
        if (scIndex == -1 || !schoolInformation[scIndex]) {
            txtKLichHoc.disabled = true;
            btnSubmit.disabled = false;
            formInputUrl.classList.add("d-none");
            lblTrangTraCuu.classList.add("d-none");
            return;
        }

        formInputUrl.classList.remove("d-none");
        lblTrangTraCuu.classList.remove("d-none");
        
        txtKLichHoc.disabled = false;
        btnSubmit.disabled = false;

        lblUrl.href = schoolInformation[scIndex].tc;
        lblKLichHoc.innerText = schoolInformation[scIndex].urlChuan;

    }

    

    var loadingSubmit = (e) => {
        if (e == true){
            btnSubmit.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Loading...';
            btnSubmit.disabled = true;
        }else{
            btnSubmit.innerHTML = "Tạo lịch"
            btnSubmit.disabled = false;
        }
    }

    const getHostname = (url) => {
        // use URL constructor and return hostname
        return new URL(url).hostname;
    }

    var onSubmitFrmLicHoc = (e) => {
        e.preventDefault();

        loadingSubmit(true);
        
        getSchendar();

    }

    var showErrorDialog = (msg) => {
        errMsg.innerText = msg;
        alertMsg.classList.add("show");
        alertMsg.classList.remove("d-none");
        loadingSubmit(false);

    }

    //https://schendar.1boxstudios.com/v2.0/gateway/generateToken.js?sc=ut&k=pbekzkCNs99D4hRJsLvuTrKCzVt7AeUhb0YmHxmFM&o=gntk

    var getSchendar = async () => {

        if (!schoolInformation[sltSchool.value]) {
           showErrorDialog("Chưa chọn trường!");
            return;
        }

        if (!txtKLichHoc.value) {
            showErrorDialog("Chưa điền đủ thông tin, hãy kiểm tra lại!");
            return;
        }

        let getK = getParameterByName("k", txtKLichHoc.value);
        if (!getK) {
            getK = txtKLichHoc.value;
        }else {
            let hostInput = getHostname(txtKLichHoc.value);
            let host = getHostname(schoolInformation[sltSchool.value].urlChuan);
            if (hostInput.toLowerCase() != host.toLowerCase()){
                showErrorDialog("Kiểm tra lại trường học của bạn!");
                return;
            }
        }
        getK = getK.trim();

        if (getK.length < 10){
            showErrorDialog("Link lịch học không hợp lệ!");
            return;
        }
        txtKLichHoc.value = getK;

        let url = "https://schendar.1boxstudios.com/v2.0/gateway/generateToken.js?sc=" + schoolInformation[sltSchool.value].sc  + "&k=" + txtKLichHoc.value +"&o=gntk";
        
        try {
            let res = await fetch(url);
            let obj = await res.json();

            if (obj.status && obj.status == 200){


                console.log(obj.data.normal);
                modalShowLich.show();

                $.getElementById("urlLichHoc").value = obj.data.onlyStudy;
                $.getElementById("urlLichThi").value = obj.data.onlyExams;
                $.getElementById("urlLichHocThi").value = obj.data.normal;
                loadingSubmit(false);

            }else{
                showErrorDialog(obj.error);
                return;
            }
        }catch(err){
            showErrorDialog("Lỗi không xác định!");
            return;
        }

    }

    window.onload = () => {
        modalShowLich = new bootstrap.Modal(document.getElementById('modalShowLich'), {
            keyboard: false
        })

        lblTrangTraCuu = $.getElementById("lblTrangTraCuu");
        errMsg = $.getElementById("errMsg");
        alertMsg = $.getElementById("alertMsg");

        formInputUrl = $.getElementById("formInputUrl");

        sltSchool = $.getElementById("sltSchool");
        sltSchool.onchange = onChangeSchool;

        txtKLichHoc = $.getElementById("txtKLichHoc");

        lblUrl = $.getElementById("lblUrl");
        lblKLichHoc = $.getElementById("lblKLichHoc");

        btnSubmit = $.getElementById("btnSubmit");

        frmGetLichHoc = $.getElementById("frmGetLichHoc");

        frmGetLichHoc.onsubmit = onSubmitFrmLicHoc;

        btnLichHocCopy = $.getElementById("btnLichHocCopy");
        btnLichHocCopy.onclick = () => {
            copyURL($.getElementById("urlLichHoc"));
        }

        btnLichThiCopy = $.getElementById("btnLichThiCopy");
        btnLichThiCopy.onclick = () => {
            copyURL($.getElementById("urlLichThi"));
        }

        btnLichHocThiCopy = $.getElementById("btnLichHocThiCopy");
        btnLichHocThiCopy.onclick = () => {
            copyURL($.getElementById("urlLichHocThi"));
        }

    }

</script>

</html>